{% extends "base.html" %}
{% load static %}
{% block style %}
    <link href="{% static 'fontawesomefree/css/fontawesome.css' %}"
          rel="stylesheet"
          type="text/css">
    <link href="{% static 'fontawesomefree/css/solid.css' %}"
          rel="stylesheet"
          type="text/css">
{% endblock style %}
{% block content %}
    <div class="mx-auto max-w-5xl">
        <div class="inline-block w-[calc(100%-360px)]">
            <section class="mt-10 mb-8">
                <h1 class="text-2xl font-bold mb-2">{{ recruit.title }}</h1>
                <p class="text-lg">{{ recruit.creator }}</p>
                <div class="mt-4">
                    <ul class="flex">
                        {% for tag in recruit.tags.all %}
                            <li class="mr-2 last:mr-0">
                                <span class="text-sm bg-neutral-100 rounded-full py-2 px-3 before:content-['#']">{{ tag.name }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </section>
            <section>
                <h4 class="text-lg font-bold mt-10">스터디 기간</h4>
                <p>{{ recruit.start|date:'Y년 m월 d일' }} 부터 {{ recruit.end|date:'Y년 m월 d일' }} 까지</p>
                <h4 class="text-lg font-bold mt-10">모집 대상</h4>
                <p>{{ recruit.target }}</p>
                <h4 class="text-lg font-bold mt-10">진행 과정</h4>
                <p>{{ recruit.process }}</p>
                <h4 class="text-lg font-bold mt-10">추가 정보</h4>
                <p>{{ recruit.info }}</p>
            </section>
        </div>
        <div id="side"
             class="fixed w-[340px] top-[70px] right-[calc((100%-1024px)/2)]">
            <div class="border border-neutral-200 rounded-md">
                <section class="p-4">
                    <p class="text-xl flex justify-between">
                        <span>
                            {{ recruit.like_users.count }} <i class="fa-solid fa-heart text-red-500"></i>
                        </span>
                        <span class="text-base self-center">모집 인원: {{ recruit.members.count }}/{{ recruit.total_seats }}</span>
                    </p>
                    <p class="mt-4">{{ recruit.deadline|date:'Y년 m월 d일' }} 까지</p>
                </section>
                {% if user.is_authenticated %}
                    <section class="p-4">
                        {% if request.user == recruit.creator %}
                            <a href="{% url 'recruits:recruit_request' recruit.id %}"
                               class="bg-neutral-200 hover:bg-neutral-400 hover:text-white py-1 px-2 rounded-md">참가 신청 확인</a>
                        {% else %}
                            {% if recruit.total_seats > recruit.members.count %}
                                <h2 class="text-lg font-bold">참가 신청하기</h2>
                                {% for message in messages %}
                                    <div class="bg-red-200 p-2 rounded-md mt-2 before:content-['•'] before:pr-2">{{ message }}</div>
                                {% endfor %}
                                <form onsubmit="recruit_confirm('{{ user.username }}', '{{ recruit.title }}' , '{{ recruit.creator.id }}')"
                                      action=""
                                      method="post">
                                    {% csrf_token %}
                                    <div class="mt-3 p-2 border-2 border-neutral-500 rounded-md">
                                        <label for="id_content">
                                            <textarea name="content"
                                                      rows="5"
                                                      required
                                                      id="id_content"
                                                      class="resize-none w-full outline-none text-sm"></textarea>
                                        </label>
                                    </div>
                                    <input class="cursor-pointer bg-neutral-200 hover:bg-neutral-400 hover:text-white py-1 px-2 rounded-md mt-4"
                                           type="submit"
                                           value="신청하기">
                                </form>
                            {% endif %}
                        {% endif %}
                    </section>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock content %}
{% block websocket %}
    function recruit_confirm(user, recruit, user_id) {
    var notice = {
    "content" :  user+"(이)가 "+recruit+"에 참가를 신청했습니다.",
    "user_id" : user_id
    };
    notice_socket.send(JSON.stringify(notice));
    };
{% endblock websocket %}
