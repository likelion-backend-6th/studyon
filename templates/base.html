{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="description" content="study on">
        <meta name="keywords" content="study, recruit, plan, todo">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Study On</title>
        <link rel="stylesheet" href="{% static 'css/base.css' %}">
        {% block style %}
        {% endblock style %}
    </head>
    <body>
        <div class="h-full">
            <div class="fixed w-full h-[60px] border-b border-neutral-300 bg-[rgba(255,255,255,.88)] backdrop-blur-xl backdrop-saturate-150 z-50">
                <div class="mx-auto max-w-5xl flex items-center h-full">
                    <a href="{% url 'recruits:index' %}"class="flex">
                        <h1 class="self-center text-lg text-cyan-700 font-bold">StudyOn</h1>
                    </a>
                    <div class="ml-auto flex h-full text-base">
                        {% if user.is_authenticated %}
                            <div id="notice"></div>
                            <div class="flex items-center font-bold">
                                <a href="{% url 'message:list_notices' %}">알림</a>
                            </div>
                            <div class="flex items-center font-bold pl-6">
                                <a href="{% url 'message:list_messages' %}">메세지</a>
                            </div>
                            <div class="flex items-center font-bold pl-6">
                                <a href={% url 'users:info' %}>내 정보</a>
                            </div>
                            <div class="flex items-center font-bold pl-6">
                                <a href={% url 'manager:studies_list' %}>스터디 관리</a>
                            </div>
                            <div class="flex items-center font-bold pl-6">
                                <a href={% url 'users:logout' %}>로그아웃</a>
                            </div>
                        {% else %}
                            <div class="flex items-center font-bold pl-6">
                                <a href={% url 'users:login' %}>로그인</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="h-[60px]"></div>
            <div class="h-[calc(100%-60px)]">
                {% block content %}
                {% endblock content %}
            </div>
        </div>
    </body>
    {% block script %}
    {% endblock script %}
    <script>
        var href = document.location.href; // 전체 url
        var protocol = window.location.protocol; // http: or https:
        var host = window.location.host; // 호스트 네임 ex) 127.0.0.1 , localhost
        var link = href.replace(protocol+"//","").replace(host,"");
        var notice_socket = new WebSocket("ws://" + host + "/ws/notice/");

        {% block websocket %}
        
        {% endblock websocket %}

        notice_socket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            const notice = document.getElementById("notice");
            if ( data.user_ids.includes({{ user.id }})){
                notice.innerHTML = "<p>" + data.content + "</p>";
            } 
            if (data.reciever_id == {{ user.id }}) {
                notice.innerHTML = "<p>" + data.content + "</p>";
            }
            setTimeout(function () {
                notice.innerHTML = '' ;
            }, 3000);
        };
    </script>
</html>
